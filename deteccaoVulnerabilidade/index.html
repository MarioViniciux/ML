<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análise de Ameaças STRIDE</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; color: #333; max-width: 900px; margin: 20px auto; padding: 0 15px; }
        h1, h2 { color: #1a237e; }
        textarea { width: 100%; min-height: 150px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; margin-bottom: 10px; }
        button { background-color: #28a745; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #218838; }
        #resultados { margin-top: 30px; }
        .componente { border-left: 4px solid #1a237e; padding-left: 15px; margin-bottom: 25px; }
        .ameaca { background-color: #f8f9fa; border: 1px solid #e9ecef; border-radius: 5px; padding: 10px; margin-bottom: 10px; }
        .categoria { font-weight: bold; color: #d32f2f; }
        #loading { display: none; text-align: center; font-size: 18px; color: #555; }
    </style>
</head>
<body>

    <h1>Ferramenta de Análise de Ameaças STRIDE</h1>
    <p>Digite os componentes do seu sistema, um por linha, na caixa abaixo. Exemplos: "API de Login", "Banco de Dados de Produtos", "Fila de Mensagens", etc.</p>

    <form id="stride-form">
        <textarea id="componentes" placeholder="Servidor de Autenticação&#10;Banco de Dados de Usuários&#10;API de Pagamentos"></textarea>
        <button type="submit">Analisar Ameaças</button>
    </form>

    <div id="loading">Analisando...</div>

    <div id="resultados">
        </div>

    <script>
        const form = document.getElementById('stride-form');
        const resultadosDiv = document.getElementById('resultados');
        const loadingDiv = document.getElementById('loading');
        
        const apiUrl = 'http://127.0.0.1:8000/analisar';

        form.addEventListener('submit', async (event) => {
            event.preventDefault();
            
            const componentesText = document.getElementById('componentes').value;
            const componentesArray = componentesText.split('\n').filter(line => line.trim() !== '');

            if (componentesArray.length === 0) {
                alert('Por favor, insira pelo menos um componente.');
                return;
            }

            loadingDiv.style.display = 'block';
            resultadosDiv.innerHTML = '';

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ componentes: componentesArray })
                });

                if (!response.ok) {
                    throw new Error(`Erro na API: ${response.statusText}`);
                }

                const data = await response.json();
                exibirResultados(data);

            } catch (error) {
                resultadosDiv.innerHTML = `<p style="color: red;">Ocorreu um erro: ${error.message}. Verifique se a API Python está rodando.</p>`;
            } finally {
                loadingDiv.style.display = 'none';
            }
        });

        function exibirResultados(data) {
            resultadosDiv.innerHTML = '<h2>Resultados da Análise STRIDE</h2>';
            
            for (const componenteNome in data) {
                const componenteDiv = document.createElement('div');
                componenteDiv.className = 'componente';

                const tituloComponente = document.createElement('h3');
                tituloComponente.textContent = `Componente: ${componenteNome}`;
                componenteDiv.appendChild(tituloComponente);
                
                const ameacas = data[componenteNome];
                ameacas.forEach(ameaca => {
                    const ameacaDiv = document.createElement('div');
                    ameacaDiv.className = 'ameaca';
                    ameacaDiv.innerHTML = `<p><span class="categoria">${ameaca.categoria}:</span> ${ameaca.descricao}</p>`;
                    componenteDiv.appendChild(ameacaDiv);
                });
                
                resultadosDiv.appendChild(componenteDiv);
            }
        }
    </script>
</body>
</html>